<ng-container *ngIf="state.isFloating">
  <!-- Minimized Glass Button -->
  <div 
    *ngIf="state.isMinimized" 
    class="glass-button-container"
    [@glassButtonAnimation]
    (click)="restore()">
    <div class="glass-button">
      <mat-icon>play_arrow</mat-icon>
    </div>
  </div>

  <!-- Main Player -->
  <div 
    *ngIf="!state.isMinimized"
    #playerContainer 
    [ngClass]="playerClasses"
    [@playerAnimation]>
    <div class="video-wrapper">
      <app-video-player 
        *ngIf="state.videoUrl"
        [src]="state.videoUrl!"
        [isPlaying]="state.isPlaying"
        [seekTime]="state.seekTo"
        (timeUpdate)="onTimeUpdate($event)"
        (durationChange)="onDurationChange($event)"
        (loaded)="onLoaded()"
      >
      </app-video-player>
    </div>

    <!-- Hover Controls Overlay -->
    <div class="controls-overlay">
      <!-- Top-right Close Button -->
      <button class="control-button close-button" (click)="close()">
        <mat-icon>close</mat-icon>
      </button>

      <!-- Bespoke Progress Bar -->
      <div class="progress-container">
        <span class="time-label">{{ formatTime(state.currentTime) }}</span>
        <div class="progress-bar-container" (click)="onProgressBarClick($event)">
          <div class="progress-bar-fill" [style.width.%]="progressPercent"></div>
        </div>
        <span class="time-label">{{ formatTime(state.duration) }}</span>
      </div>

      <!-- Main Controls -->
      <div class="main-controls">
        <button class="control-button" (click)="mediaPlayerService.setPlaying(!state.isPlaying)">
          <mat-icon>{{ state.isPlaying ? 'pause' : 'play_arrow' }}</mat-icon>
        </button>
        <button class="control-button" (click)="toggleSize()" [disabled]="state.isFakeFullscreen">
          <mat-icon>{{ state.pipSize === 'full' ? 'unfold_less' : 'unfold_more' }}</mat-icon>
        </button>
        <button class="control-button" (click)="toggleFullscreen()">
          <mat-icon>{{ state.isFakeFullscreen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
        </button>
        <button class="control-button" (click)="togglePositionSelector()" [disabled]="state.isFakeFullscreen">
          <mat-icon>open_with</mat-icon>
        </button>
        <button class="control-button" (click)="minimize()">
          <mat-icon>minimize</mat-icon>
        </button>
      </div>
    </div>
    
    <!-- Position Selector Overlay -->
    <div *ngIf="showPositionSelector" class="position-selector-overlay" (click)="togglePositionSelector(false)">
      <div class="position-grid">
        <button class="position-button" (click)="setPosition('top-left'); $event.stopPropagation()"><mat-icon>north_west</mat-icon></button>
        <button class="position-button" (click)="setPosition('top-right'); $event.stopPropagation()"><mat-icon>north_east</mat-icon></button>
        <button class="position-button center" (click)="setPosition('center'); $event.stopPropagation()"><mat-icon>center_focus_strong</mat-icon></button>
        <button class="position-button" (click)="setPosition('bottom-left'); $event.stopPropagation()"><mat-icon>south_west</mat-icon></button>
        <button class="position-button" (click)="setPosition('bottom-right'); $event.stopPropagation()"><mat-icon>south_east</mat-icon></button>
      </div>
    </div>
  </div>
</ng-container> 